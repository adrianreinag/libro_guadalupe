---
// index.astro
import BaseLayout from '../../../layouts/BaseLayout.astro';
import HeaderComponent from '../../../components/HeaderComponent.astro';

import leccionarioData from '../../../data/leccionario.json';
import cantosData from '../../../data/cantos.json';
import { Leccionario } from '../../../classes/leccionario.ts';
import { Cantos } from '../../../classes/cantos.ts';
import BodyLayout from '../../../layouts/BodyLayout.astro';
import CantoComponent from '../../../components/CantoComponent.astro';

interface Path {
  params: {
    dia: string;
  };
}

export async function getStaticPaths(): Promise<Path[]> {
  const dias = ['viernes', 'sabado', 'domingo'];
  return dias.map(dia => ({ params: { dia } }));
}

const { dia } = Astro.params;

if (!['viernes', 'sabado', 'domingo'].includes(dia)) {
  return Astro.redirect('/404'); // Redirigir a 404 si el día no es válido
}

const getLecturas = (diaSeleccionado: string) => Leccionario.fromJSON(leccionarioData, diaSeleccionado);
const getCantos = (diaSeleccionado: string) => Cantos.fromJSON(cantosData, diaSeleccionado);

const lecturas = getLecturas(dia);
const cantos = getCantos(dia);

---

<BaseLayout title="Eucaristía">
  <HeaderComponent title="Eucaristía"/>
  <BodyLayout>
    <h1 class="titulo-dia">{lecturas.dia}</h1>
    <div>
      <nav class="tabbar">
        <button class="tab-item active selected" data-tab="lecturas">Lecturas</button>
        <button class="tab-item" data-tab="cantos">Cantos</button>
        <button class="tab-item" data-tab="oraciones">Oraciones</button>
      </nav>
      <div class="tab-content">
          <div id="lecturas" class="tab-pane active">
            <h2 class="titulo-seccion">Primera lectura</h2>
            <p class="comentario-derecha">{lecturas.primeraLectura.cita}</p>
            <h3 class="titulo-salmos">{lecturas.primeraLectura.titulo}</h3>
            <p set:html={lecturas.primeraLectura.texto} class="parrafo"></p>
        
            {lecturas.salmo && (
              <>
                <h2 class="titulo-seccion">Salmo responsorial</h2>
                <h3 class="titulo-salmos">Salmo {lecturas.salmo.titulo}</h3>
                <p class="parrafo"><span class="red">Ant. </span>{lecturas.salmo.antifona}</p>
                <div>
                  {lecturas.salmo.versos.map((verso: string, index: any) => (
                    <div class="verso-contenedor">
                      <p set:html={verso} class="parrafo"></p>
                    </div>
                  ))}
                </div>
              </>
            )}
        
            {lecturas.segundaLectura && (
              <>
                <h2 class="titulo-seccion">Segunda lectura</h2>
                <p class="comentario-derecha">{lecturas.segundaLectura.cita}</p>
                <h3 class="titulo-salmos">{lecturas.segundaLectura.titulo}</h3>
                <p set:html={lecturas.segundaLectura.texto} class="parrafo"></p>
              </>
            )}
        
            <h2 class="titulo-seccion">Evangelio</h2>
            <p class="comentario-derecha">{lecturas.evangelio.cita}</p>
            <h3 class="titulo-salmos">{lecturas.evangelio.titulo}</h3>
            <p set:html={lecturas.evangelio.texto} class="parrafo"></p>
          </div>
      </div>
      <div id="cantos" class="tab-pane">
        {cantos ? (
          <>
            {cantos.entrada && (
              <CantoComponent titulo="Entrada" subtitulo={cantos.entrada.titulo} letra={cantos.entrada.letra} />
            )}
            {cantos.aleluya && (
              <CantoComponent titulo="Aleluya" subtitulo={cantos.aleluya.titulo} letra={cantos.aleluya.letra} />
            )}
            {cantos.ofertorio && (
              <CantoComponent titulo="Ofertorio" subtitulo={cantos.ofertorio.titulo} letra={cantos.ofertorio.letra} />
            )}
  
            {cantos.comunion && cantos.comunion.length > 0 && ( // Solo renderizar si hay cantos de comunión
              <>
                <h2 class="titulo-canto">Comunión</h2>
                {cantos.comunion.map((canto, index) => (
                  <div>
                    <h3 class="subtitulo-canto">{canto.titulo}</h3>
                    <p set:html={canto.letra} class="parrafo"></p>
                  </div>
                ))}
              </>
            )}
  
             {cantos.virgen && (
               <CantoComponent titulo="Canto a la Virgen" subtitulo={cantos.virgen.titulo} letra={cantos.virgen.letra} />
             )}
  
  
          </>
        ) : (
          <p>No se encontraron cantos para este día.</p>
        )}
      </div>
      <div id="oraciones" class="tab-pane">
          <h1 class="titulo-seccion">Oración preparatoria</h1>
          <p class="comentario-centrado">Puedes hacer esta oración antes de empezar la eucaristía.</p>
          <p class="parrafo">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed auctor, justo nec ultricies ultricies, nunc nisl ultricies nunc, nec ultricies nunc nisl nec nunc. Nullam nec nunc nec nunc.</p>
          <h1 class="titulo-seccion">Después de la comunión</h1>
          <p class="comentario-centrado">Puedes hacer esta oración después de comulgar.</p>
          <p class="parrafo">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed auctor, justo nec ultricies ultricies, nunc nisl ultricies nunc, nec ultricies nunc nisl nec nunc. Nullam nec nunc nec nunc.</p>
          <h1 class="titulo-seccion">Comunión espiritual</h1>
          <p class="comentario-centrado">Puedes hacer esta oración si no puedes comulgar.</p>
          <p class="parrafo">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed auctor, justo nec ultricies ultricies, nunc nisl ultricies nunc, nec ultricies nunc nisl nec nunc. Nullam nec nunc nec nunc.</p>
          <h1 class="titulo-seccion">Oración final</h1>
          <p class="comentario-centrado">Puedes hacer esta oración al finalizar la eucaristía.</p>
          <p class="parrafo">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed auctor, justo nec ultricies ultricies, nunc nisl ultricies nunc, nec ultricies nunc nisl nec nunc. Nullam nec nunc nec nunc.</p>
      </div>
    </div>
  </BodyLayout>
</BaseLayout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
      const tabs = document.querySelectorAll('.tab-item');
      const tabPanes = document.querySelectorAll('.tab-pane');

      tabs.forEach(tab => {
          tab.addEventListener('click', () => {
              const targetTab = tab.getAttribute('data-tab');
              if (targetTab) {
                  tabs.forEach(t => {
                      t.classList.remove('active', 'selected');
                  });
                  tabPanes.forEach(pane => pane.classList.remove('active'));

                  tab.classList.add('active', 'selected');
                  const targetPane = document.getElementById(targetTab);
                  if (targetPane) {
                      targetPane.classList.add('active');
                  }
              }
          });
      });
  });
</script>
